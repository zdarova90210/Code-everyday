# Основные понятия Docker

- **Контейнер** — это изолированное окружение, в котором запускается приложение со всеми необходимыми зависимостями.
- **Образ (Image)** — это шаблон для создания контейнера, содержащий операционную систему, библиотеки, скрипты и настройки.
- **Контейнеры** создаются на основе образов и представляют собой исполняемую (или работающую) версию образа.

---

# Основные команды Docker

| Команда                                | Описание                                                                 |
|----------------------------------------|--------------------------------------------------------------------------|
| `docker images`                        | Получить список образов.                                                 |
| `docker run -p 8080:80 [image id]`     | Запустить контейнер, пробросив локальный порт 8080 на порт 80 в контейнере. |
| `docker ps`                            | Список запущенных контейнеров.                                           |
| `docker ps -a`                         | Список всех контейнеров, включая остановленные.                          |
| `docker start [container id|name]`     | Перезапуск остановленного контейнера с заданным ID или именем.           |
| `docker stop [container id|name]`      | Остановка запущенного контейнера с заданным ID или именем.               |
| `docker rmi [image id]`                | Удалить образ с указанным ID.                                            |
| `docker rm [container id]`             | Удалить остановленный контейнер.                                         |
| `docker logs [container id|name]`      | Посмотреть логи контейнера.                                              |
| `docker exec -it [container id] bash`  | Войти внутрь работающего контейнера через bash.                          |

---

# Порты при запуске контейнера: `-p` и `EXPOSE`

### Разбираем флаг `-p 8080:80`

`-p` — это сокращение от слова **publish** (публиковать).

#### Как работает `-p`:
1. **8080** (до двоеточия) — это порт на вашем ПК (хостовая машина), который будет связан с портом приложения внутри контейнера.
2. **80** (после двоеточия) — это порт внутри контейнера. С одной стороны он связан с портом на вашем ПК (8080), а с другой стороны, как правило, с приложением внутри контейнера.

Например, **nginx** по умолчанию слушает 80-й порт. Поэтому, если вы запускаете контейнер с nginx и его стандартными настройками, вам нужно задействовать именно 80-й порт внутри контейнера.

#### Пример:
Команда запуска:
```bash
docker run -p 8080:80 nginx-server
```

Что происходит:
- Локально вы обращаетесь по адресу `localhost:8080`.
- Этот запрос будет перенаправлен на 80-й порт внутри контейнера, где работает приложение (в данном случае — nginx).
- Nginx обработает запрос и вернёт, например, файл **index.html**, который вы увидите в браузере.

#### Итог:
Флаг `-p` связывает порт на вашем ПК с портом внутри контейнера, обеспечивая обмен данными с приложением, работающим в контейнере.

---

### Инструкция `EXPOSE`

`EXPOSE` в Dockerfile служит для указания портов, по которым приложение внутри контейнера готово принимать входящие подключения (только внутри сети контейнера). Однако важно понимать, что:
- **EXPOSE только документирует порты** и сам по себе ничего не настраивает.
- Чтобы открыть порт для внешнего доступа, используйте флаг `-p` при запуске контейнера.

#### Пример:
Dockerfile:
```dockerfile
EXPOSE 80
```

Команда для публикации порта:
```bash
docker run -p 8080:80 nginx-server
```

#### Использование `EXPOSE` на практике:
- EXPOSE помогает разработчикам документировать порты, ожидаемые приложением.
- В Docker Compose эта инструкция может использоваться для настройки сетей контейнеров (без явного указания проброса портов).

#### Итог:
- Используйте `EXPOSE` для указания внутренних портов и документирования, а флаг `-p` — для реальной публикации портов наружу.

---

# Очистка Docker-ресурсов

Когда вы работаете с Docker, могут накапливаться неиспользуемые ресурсы (контейнеры, образы, тома и сети). Чтобы очистить их, используйте следующие команды:

1. **Удалить все контейнеры:**
   ```bash
   docker rm $(docker ps -aq)
   ```

2. **Удалить остановленные контейнеры:**
   ```bash
   docker container prune
   ```

3. **Удалить неиспользуемые образы:**
   ```bash
   docker image prune
   docker image prune -a  # Удаляет абсолютно все неиспользуемые образы
   ```

4. **Удалить неиспользуемые тома:**
   ```bash
   docker volume prune
   ```

5. **Удалить все ресурсы:**
   Удаление контейнеров, старых образов, томов, сетей:
   ```bash
   docker system prune
   docker system prune -a  # С полной очисткой
   ```

---

# Полезные команды Docker

| Команда                                | Описание                                                                 |
|----------------------------------------|--------------------------------------------------------------------------|
| `docker logs [container id|name]`      | Показать логи работы контейнера.                                         |
| `docker exec -it [container id] bash`  | Зайти внутрь работающего контейнера с помощью bash.                      |
| `docker volume prune`                  | Удалить неиспользуемые тома.                                             |
| `docker stop $(docker ps -aq)`         | Остановить все запущенные контейнеры.                                    |
| `docker rm $(docker ps -aq)`           | Удалить остановленные контейнеры.                                        |
| `docker system prune`                  | Очистить все неиспользуемые ресурсы.                                     |

---

# Docker Compose

`docker-compose` — инструмент для работы с многоконтейнерными приложениями. Вместо ручного запуска контейнеров с настройками, вы описываете их в файле `docker-compose.yml`.

#### Пример файла `docker-compose.yml`:
```yaml
version: '3'
services:
  web:
    image: nginx
    ports:
      - "8080:80"
```

#### Запуск с помощью Docker Compose:
```bash
docker-compose up
```